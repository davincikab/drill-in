 <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
    crossorigin=""/>

    <style>
        *{font-family:Montserrat,Montserrat,sans-serif;padding:0;margin:0;box-sizing:border-box;z-index:1}body{padding:0;margin:0}#map-container{position:relative;width:100%;height:100vh}#map{height:100%;width:100%;z-index:0;position:relative;outline:0}.county:hover{fill-opacity:0.5}.county.active{fill-opacity:0.2}.county.active:hover{fill-opacity:0.2}.leaflet-bar.leaflet-control{box-shadow:0 1px 5px rgb(0 0 0 / 65%);border-radius:4px}.leaflet-touch .leaflet-bar a{width:26px;height:26px;line-height:26px}.leaflet-marker-pane .count-marker div{width:220px;padding:.6rem .8rem;color:#fff;background-color:#539542B3;background-color:#318ce7b6;pointer-events:none}.leaflet-marker-pane .count-marker div span.state{font-size:14px;font-weight:700;text-transform:uppercase}.leaflet-popup-content-wrapper{border-radius:5px}.popup-content{display:flex}.popup-content .state{font-size:1rem;font-weight:700;text-transform:uppercase}.count-state{text-align:center;font-size:1rem;color:#333}.count-marker div span{display:block;width:100%}#map-container #backBtn{position:absolute;top:80px;left:0;display:flex;box-shadow:0 0 .25rem #222;justify-content:center;align-items:center;border-radius:0 5px 5px 0;padding:6px 10px;line-height:1;background-color:#fff;z-index:99;cursor:pointer;transition:background-color .2s ease-in-out}        
    </style>

    <div class="map-container" id="map-container">
        <div id="backBtn">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 402.9 400.4">
            <path d="M66 104l38.2-3.6v-25l-5.6-20 12.8 1 8.1-1.5-.5 13.3 27 7.2 16.4-5.1-1-6.2 37.3-20.4 10.2-33.2 27-8.7 6.2 13.8h9.2l3 13.8 25.6 9.7 2 12.3 8.7 5 10.2-8.6 2.6 14.8 16.8 11.2 11.2 3.6 11.8.5L358 92.7l42.4 9.7-13.3 19.4-1.5 39.4-7.2 10.2-9.7-4.6-1 6.1-29.6 37.8-.5 8.2-5.6 8.6 10.2 1 1.5-10.7 13.3-1s5.6 27 8.7 23c-4.1-.5-6.2 8.7-6.2 8.7l10.7 19.9-8.1 5.6-9.2 2 9.2 14.3 2.5 8.2-3.5 10.7 12.2 12.3 14.8-1.5 1.6 5.6-6.7 12.7-6.1-2-2 4-3.6.6-2 6.1-3.6-.5-13.3 11.3-.5 6-26 3.7-14.4-6.2-1.5-4.6-8.2-1 2-8.7-7-3.5-7.2 10.7-7.2-5.1-10.7-1-6.1-6.2-17.9 12.8h-6.6l-11.8 17.9 2.6 6-1 11.8-13.3 8.2-12.3-7.1-8.7 3-9.7-6.6-.5-5.1-5-3.6h-6.7L155.3 369l-5.6 4-15.4 1.6-55.1-22.5 2.5-6-15.8-7.2L95 279.6l8.7-38.3v-33.2l-28.6-29.6 2-16.3-18.9-20-54-28.5 13.7-3.6-13.8-9.7 13.3-11.2s31.1-.6 35.2-3.1C54.6 91.7 66 104 66 104z" fill="#65768a" stroke="#fff" stroke-miterlimit="10" stroke-width="3"></path>
            </svg>
            <span>Reset</span>
        </div>

        <div id="map"></div>
    </div>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
   integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
   crossorigin=""></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.2.1/d3.min.js" integrity="sha512-wkduu4oQG74ySorPiSRStC0Zl8rQfjr/Ty6dMvYTmjZw6RS5bferdx8TR7ynxeh79ySEp/benIFFisKofMjPbg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        const config={iconUrl:"icons/pin.svg",statesRef:{bretagne:[48.748945343432936,-6.229248046875001],normandie:[50.24720490139267,-3.9221191406250004],hauts_de_france:[51.16556659836182,.49438476562500006],grand_est:[49.23912083246701,4.801025390625001],pays_de_la_loire:[47.17477833929906,-5.570068359375001],centre_val_de_loire:[47.41322033016904,-.27465820312500006],"bourgogne-franche-comté":[47.41322033016904,5.394287109375],nouvelle_aquitaine:[45.583289756006316,-3.3947753906250004],occitanie:[43.644025847699496,-.31860351562500006],auvergne_rhone_alpes:[45.67548217560647,4.053955078125001],provence_alpes_cote_dazur:[44.040218713142146,6.009521484375],ile_de_france:[0,0],corse:[0,0]}},map=L.map("map",{center:[46.58150100708008,2.4609055519104004],zoom:6,minZoom:6,maxZoom:12,doubleClickZoom:!1,scrollWheelZoom:!1,maxBoundsViscosity:0,zoomControl:!1});let points=[];const zoomControl=L.control.zoom(),resetBtn=document.getElementById("backBtn");resetBtn.addEventListener("click",function(o){o.stopPropagation(),resetView()}),L.tileLayer("https://{s}.tile.openstreetmap.fr/openriverboatmap/{z}/{x}/{y}.png",{attribution:"© OSM Contributors - tiles OpenRiverboatMap",transparent:!0,opacity:.7}).addTo(map);let tipIcon=L.divIcon({className:"",html:""}),tooltipMarker=L.marker([0,0],{icon:tipIcon}).bindTooltip("").addTo(map);var activeRegion;function getFillColor(o){let e="#65768a";return activeRegion&&activeRegion.properties.nom==o.properties.nom&&(e="#fff"),e}const regionsJson=L.geoJSON(null,{onEachFeature:function(o,e){e.on("click",function(e){console.log(e.latlng),activeRegion&&activeRegion!==o?(map.panTo(e.latlng),updateCountyPoints(o)):(map.setZoomAround(e.latlng,9),updateCountyPoints(o)),activeRegion=o,updateFillColor(e)}),e.on("mouseover",function(e){tooltipMarker.setLatLng(e.latlng).setTooltipContent(o.properties.nom)}),e.on("mouseleave",function(o){})},style:function(o){return{fillColor:getFillColor(o),fillOpacity:.8,color:"#ddd",weight:2,className:"county"}}}).addTo(map),pntIcons=L.icon({iconUrl:config.iconUrl,iconSize:this.L.point(12.47,22)}),regionPoints=L.geoJSON(null,{onEachFeature:function(o,e){},pointToLayer:function(o,e){let t=getPopupContent(o);return L.marker(e,{icon:pntIcons}).bindPopup(t)}}).addTo(map);function getPopupContent(o){let{count:e}=o.properties;return console.log("Popup"),`<div class="popup-content">\n        <div class="content">\n            <span class="state">${o.properties.Title}</span>\n            <div class="count-state"><font style="vertical-align: inherit;">\n                <font style="vertical-align: inherit;">${e} ${e>1?"Bâtiments":"Bâtiment"}</font></font>\n            </div>\n\n            <div><b>Region</b><div>\n            <div>${o.properties.Region}</div>\n            <div><b>Description</b><div>\n            <div>${o.properties.Description}</div>\n        </div>\n        <div>\n\n        </div>\n    </div>`}const divIcons=function(o,e){const t=`<div style=""><span class="state">${o}</span><span>${e} ${e>1?"Bâtiments":"Bâtiment"}</span></div>`;return L.divIcon({html:t,className:"count-marker"})},countPoints=L.geoJSON(null,{pointToLayer:function(o,e){return L.marker(e,{icon:divIcons(o.properties.nom,o.properties.count)})}}).addTo(map);function zoomToBounds(o){map.fitBounds(o.getBounds())}function updateCountsData(o){return console.log(o),Object.keys(config.statesRef).map(e=>{let[t,n]=config.statesRef[e];return{count:o.filter(o=>o.Region.toLowerCase()==e).length,nom:e.split("_").join(" "),Latitude:t,Longitude:n}})}function updateFillColor(o){regionsJson.eachLayer(o=>{o.getElement().classList.remove("active")}),o.target.getElement().classList.add("active")}function getPointGeojson(o){return{type:"FeatureCollection",features:[...o.map(function(o){return{type:"Feature",geometry:{type:"Point",coordinates:[parseFloat(o.Longitude),parseFloat(o.Latitude)]},properties:{...o}}})]}}function updateCountyPoints(o){let e=getPointGeojson(points.filter(e=>e.Region==o.properties.nom));console.log(e),regionPoints.clearLayers(),regionPoints.addData(e)}function resetView(){console.log("Reset View"),map.setMinZoom(6),map.setView([46.58150100708008,2.4609055519104004],6),map.scrollWheelZoom.disable(),regionPoints.clearLayers(),regionsJson.eachLayer(o=>{o.getElement().classList.remove("active")}),activeRegion=null}fetch("https://davincikab.github.io/drill-in/county.geojson").then(o=>o.json()).then(o=>{regionsJson.addData(o)}).catch(console.error),d3.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vTEF_IRgsIsNx2MGYj313bILCMJTwBACGLFloALbN8HJCAO-CgVx2QlwwYYECCTNZricqZrGcgGh1KM/pub?gid=0&single=true&output=csv").then(o=>{points=o;let e=updateCountsData(o),t=getPointGeojson(e);countPoints.addData(t),points=points.map(o=>{let t=e.find(e=>e.nom==o.Region.toLocaleLowerCase());return o.count=t?t.count:0,o})}).catch(console.error),map.on("zoomend",function(o){map.getZoom()>6?(map.addControl(zoomControl),map.scrollWheelZoom.enable(),map.setMinZoom(8),map.removeLayer(countPoints)):(map.removeControl(zoomControl),map.addLayer(countPoints))});
    </script>